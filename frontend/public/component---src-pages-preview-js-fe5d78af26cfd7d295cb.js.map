{"version":3,"sources":["webpack://gatsby-starter-default/./src/pages/preview.js"],"names":["locale","slug","data","useState","secretPage","setSecretPage","global","setGlobal","pageContext","setPageContext","useCookies","cookies","setCookie","location","useLocation","secret","URLSearchParams","search","get","site","siteMetadata","languages","locales","defaultLocale","metaData","metadata","metaTitle","strapiPreview","process","GATSBY_PREVIEW_SECRET","path","secure","sameSite","useEffect","fetchAPI","context","id","localizations","isPreview","globalData","fetchData","seo","sections","contentSections","className"],"mappings":"0PAuGA,UApFoB,SAAC,GAA4B,IAA1BA,EAAyB,EAAzBA,OAAQC,EAAiB,EAAjBA,KAAMC,EAAW,EAAXA,KAAW,GACVC,cAAS,MAAtCC,EADuC,KAC3BC,EAD2B,QAElBF,cAAS,MAA9BG,EAFuC,KAE/BC,EAF+B,QAGRJ,cAAS,MAAxCK,EAHuC,KAG1BC,EAH0B,QAIjBC,SAAtBC,EAJuC,KAI9BC,EAJ8B,KAKxCC,GAAWC,mBAEXC,EADS,IAAIC,gBAAgBH,EAASI,QACtBC,IAAI,UAPoB,EAc1ChB,EALFiB,KACEC,aACEC,UAAaC,EAX2B,EAW3BA,QAASC,EAXkB,EAWlBA,cAKtBC,EAAWpB,GAAU,iBACtBA,EAAWqB,SADW,CAEzBC,UAAU,WAAYtB,EAAWqB,SAASC,YAsC5C,OAjCEf,EAAQgB,gBAAkBC,GAAYC,uBACtCd,IAAWa,GAAYC,uBAEvBjB,EAAU,gBAAiBgB,GAAYC,sBAAuB,CAC5DC,KAAM,IACNC,OAAQH,aACRI,SAAU,YAIdC,gBAAU,YACO,mCAAG,2GACKC,OAAS,kBAAkBlC,EAAnB,SAAkCC,GAD/C,uBACTC,EADS,KAEhBG,EAAcH,GAERiC,EAAU,CACdlC,KAAMC,EAAKD,KACXmC,GAAIlC,EAAKkC,GACTpC,OAAQE,EAAKF,OACbqC,cAAenC,EAAKmC,cACpBf,UACAC,gBACAe,WAAW,GAEb7B,EAAe0B,GAbC,UAeSD,OAAS,mBAAmBlC,GAfrC,OAeVuC,EAfU,OAgBhBhC,EAAUgC,GAhBM,4CAAH,qDAmBfC,KACC,CAACvC,EAAMqB,EAASC,EAAevB,IAE7BQ,GAAgBF,EAIhBK,EAAQgB,cAWX,gCACE,gBAAC,IAAD,CAAKc,IAAKjB,IACV,gBAAC,IAAD,CAAQhB,YAAaA,EAAaF,OAAQA,GACvCF,GACC,2BACE,gBAAC,IAAD,CAAUsC,SAAUtC,EAAWuC,qBAdrC,gBAAC,IAAD,CAAQnC,YAAaA,EAAaF,OAAQA,GACxC,uBAAKsC,UAAU,oBAAf,uDANG","file":"component---src-pages-preview-js-fe5d78af26cfd7d295cb.js","sourcesContent":["/**\n * You can preview pages with URLs like this:\n * http://localhost:8000/preview/<slug>?secret=<preview-secret>\n * where <preview-secret> is the GATSBY_PREVIEW_SECRET variable defined in your .env config\n * and <slug> is the slug you entered in Strapi for your page\n */\n\nimport React, { useState, useEffect } from \"react\"\n\nimport { fetchAPI } from \"@/utils/api\"\n\nimport Sections from \"@/components/sections\"\nimport Layout from \"@/components/layout\"\nimport SEO from \"@/components/seo\"\n\nimport { useLocation } from \"@reach/router\"\nimport { useCookies } from \"react-cookie\"\nimport { graphql } from \"gatsby\"\n\nconst PreviewPage = ({ locale, slug, data }) => {\n  const [secretPage, setSecretPage] = useState(null)\n  const [global, setGlobal] = useState(null)\n  const [pageContext, setPageContext] = useState(null)\n  const [cookies, setCookie] = useCookies()\n  const location = useLocation()\n  const params = new URLSearchParams(location.search)\n  const secret = params.get(\"secret\")\n  const {\n    site: {\n      siteMetadata: {\n        languages: { locales, defaultLocale },\n      },\n    },\n  } = data\n  \n  const metaData = secretPage && {\n    ...secretPage.metadata,\n    metaTitle: `Preview ${secretPage.metadata.metaTitle}`,\n  }\n\n  // The user is correctly trying to access the preview page\n  if (\n    cookies.strapiPreview !== process.env.GATSBY_PREVIEW_SECRET &&\n    secret === process.env.GATSBY_PREVIEW_SECRET\n  ) {\n    setCookie(\"strapiPreview\", process.env.GATSBY_PREVIEW_SECRET, {\n      path: '/',\n      secure: process.env.NODE_ENV,\n      sameSite: \"Strict\",\n    })\n  }\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const [data] = await fetchAPI(`/pages?_locale=${locale}&slug=${slug}`)\n      setSecretPage(data)\n\n      const context = {\n        slug: data.slug,\n        id: data.id,\n        locale: data.locale,\n        localizations: data.localizations,\n        locales,\n        defaultLocale,\n        isPreview: true\n      }\n      setPageContext(context)\n\n      const globalData = await fetchAPI(`/global?_locale=${locale}`)\n      setGlobal(globalData)\n    }\n\n    fetchData()\n  }, [slug, locales, defaultLocale, locale])\n\n  if (!pageContext || !global) {\n    return <div>loading preview...</div>\n  }\n\n  if (!cookies.strapiPreview) {\n    return (\n      <Layout pageContext={pageContext} global={global}>\n        <div className=\"mt-4 text-center\">\n          You need to turn preview mode on to view this page\n        </div>\n      </Layout>\n    )\n  }\n\n  return (\n    <>\n      <SEO seo={metaData} />\n      <Layout pageContext={pageContext} global={global}>\n        {secretPage && (\n          <div>\n            <Sections sections={secretPage.contentSections} />\n          </div>\n        )}\n      </Layout>\n    </>\n  )\n}\n\nexport default PreviewPage\n\nexport const query = graphql`\n  query SiteQuery {\n    site {\n      siteMetadata {\n        languages {\n          locales\n          defaultLocale\n        }\n      }\n    }\n  }\n`\n"],"sourceRoot":""}